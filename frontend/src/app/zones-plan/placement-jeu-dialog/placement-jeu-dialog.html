<h2 mat-dialog-title>
      <mat-icon>add_location</mat-icon>
      Placer un jeu
    </h2>

    <mat-dialog-content>
      <form [formGroup]="form" class="placement-form">
        
        <!-- S√©lection du jeu (si depuis zone) -->
        @if (modeSelectionJeu()) {
          <mat-form-field appearance="outline">
            <mat-label>Jeu √† placer</mat-label>
            <mat-select formControlName="jeu_festival_id" required>
              @for (jeu of jeuxDisponibles; track jeu.id) {
                <mat-option [value]="jeu.id">
                  <div class="jeu-option">
                    <strong>{{ jeu.jeu_nom }}</strong>
                    <span class="editeur">{{ jeu.editeur_nom }}</span>
                    <span class="info">{{ jeu.nombre_exemplaires }} ex. ‚Ä¢ {{ jeu.tables_allouees }} tables</span>
                  </div>
                </mat-option>
              }
            </mat-select>
            <mat-icon matPrefix>extension</mat-icon>
          </mat-form-field>
        }

        <!-- S√©lection de la zone (si depuis jeu) -->
        @if (modeSelectionZone()) {
          <mat-form-field appearance="outline">
            <mat-label>Zone de placement</mat-label>
            <mat-select formControlName="zone_plan_id" required>
              @for (zone of zonesDisponibles; track zone.id) {
                <mat-option [value]="zone.id">
                  <div class="zone-option">
                    <strong>{{ zone.nom }}</strong>
                    <span class="info">
                      {{ zone.tables_disponibles }} / {{ zone.nombre_tables_total }} tables dispo
                    </span>
                  </div>
                </mat-option>
              }
            </mat-select>
            <mat-icon matPrefix>map</mat-icon>
          </mat-form-field>
        }

        <!-- Informations contextuelles -->
        @if (selectedJeu()) {
          <div class="info-box jeu-info">
            <div class="info-header">
              <mat-icon>extension</mat-icon>
              <strong>{{ selectedJeu()!.jeu_nom }}</strong>
            </div>
            <div class="info-details">
              <span>√âditeur : {{ selectedJeu()!.editeur_nom }}</span>
              <span>Exemplaires : {{ selectedJeu()!.nombre_exemplaires }}</span>
              <span>Espace estim√© : {{ selectedJeu()!.tables_allouees }} tables</span>
            </div>
          </div>
        }

        <!-- Helper: Estimation vs tables physiques -->
        @if (selectedJeu()) {
          <div class="info-box warning-box">
            <mat-icon>lightbulb</mat-icon>
            <div class="helper-text">
              <p>üí° <strong>Ce jeu n√©cessite {{ selectedJeu()!.tables_allouees }} table(s) estim√©e(s).</strong></p>
              <p>S√©lectionnez au minimum <strong>{{ estimatedTables() }} table(s) physique(s)</strong> pour le placer.</p>
              <p style="font-size: 0.85em; opacity: 0.8;">
                Les tables physiques (standard, grandes, mairie) doivent √™tre enti√®res car il s'agit de tables r√©elles.
              </p>
            </div>
          </div>
        }

        @if (selectedZone()) {
          <div class="info-box zone-info">
            <div class="info-header">
              <mat-icon>map</mat-icon>
              <strong>{{ selectedZone()!.nom }}</strong>
            </div>
            <div class="info-details">
              <span>Tables disponibles : {{ selectedZone()!.tables_disponibles }} / {{ selectedZone()!.nombre_tables_total }}</span>
            </div>
          </div>
        }

        <!-- Types de tables -->
        <h3 class="section-title">
          <mat-icon>table_chart</mat-icon>
          Types de tables √† utiliser
        </h3>

        <div class="tables-grid">
          <mat-form-field appearance="outline">
            <mat-label>Tables standard</mat-label>
            <input matInput type="number" min="0" formControlName="nb_tables_std">
            <mat-icon matPrefix>crop_square</mat-icon>
            <span matSuffix>tables</span>
            <mat-hint>Petites tables (4 chaises)</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Tables grandes</mat-label>
            <input matInput type="number" min="0" formControlName="nb_tables_gde">
            <mat-icon matPrefix>crop_landscape</mat-icon>
            <span matSuffix>tables</span>
            <mat-hint>Grandes tables (6 chaises)</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Tables mairie</mat-label>
            <input matInput type="number" min="0" formControlName="nb_tables_mairie">
            <mat-icon matPrefix>table_restaurant</mat-icon>
            <span matSuffix>tables</span>
            <mat-hint>Tables mairie (6 chaises)</mat-hint>
          </mat-form-field>
        </div>

        <!-- Total calcul√© -->
        <div class="total-info">
          <div class="total-label">
            <mat-icon>calculate</mat-icon>
            Total de tables :
          </div>
          <div class="total-value" [class.warning]="totalTables() === 0">
            {{ totalTables() }}
          </div>
        </div>

        @if (totalTables() === 0) {
          <div class="warning-box">
            <mat-icon>warning</mat-icon>
            <span>Vous devez s√©lectionner au moins une table</span>
          </div>
        }

        @if (totalTables() > (selectedZone()?.tables_disponibles ?? MAX_TABLES)) {
          <div class="error-box">
            <mat-icon>error</mat-icon>
            <span>
              Pas assez de tables disponibles dans cette zone 
              ({{ totalTables() }} > {{ selectedZone()?.tables_disponibles }})
            </span>
          </div>
        }
      </form>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
      <button mat-button (click)="onCancel()">Annuler</button>
      <button 
        mat-raised-button 
        color="primary" 
        [disabled]="form.invalid || totalTables() === 0 || hasError()"
        (click)="onSubmit()">
        <mat-icon>check</mat-icon>
        Placer le jeu
      </button>
    </mat-dialog-actions>