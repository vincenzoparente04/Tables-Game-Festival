

#etape 1
FROM node:22-alpine AS build
WORKDIR /app

# Copie des fichiers de d√©pendances et installation
COPY package*.json ./
RUN npm ci

# Copie des fichiers TS et config
COPY tsconfig.json ./
COPY src ./src

# Compilation TypeScript
RUN npx tsc -p tsconfig.json --pretty false --noEmitOnError false && \
    echo "üëç Compilation TS termin√©e" && \
    ls -la dist




#etape 2
FROM node:22-alpine AS runtime
WORKDIR /app

ENV NODE_ENV=production

# On r√©cup√®re le code compil√© depuis l'√©tape build
COPY --from=build /app/dist ./dist
COPY package*.json ./

# On installe uniquement les d√©pendances de production
RUN npm ci --omit=dev

EXPOSE 4000

# Commande pour d√©marrer le serveur
CMD ["node", "dist/server.js"]
